<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Latest Posts &#8211; Fun With Code</title>
<meta name="description" content="Describe this nonsense.">
<meta name="keywords" content="Jekyll, theme, themes, responsive, blog, modern">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="/images/abstract-1.jpg">

<meta name="twitter:title" content="Latest Posts">
<meta name="twitter:description" content="Describe this nonsense.">
<meta name="twitter:creator" content="@https://twitter.com/_chriscoffey">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Latest Posts">
<meta property="og:description" content="Describe this nonsense.">
<meta property="og:url" content="/index.html">
<meta property="og:site_name" content="Fun With Code">





<link rel="canonical" href="/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Fun With Code Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post-index" class="feature">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="/images/lambda.jpeg" alt="Chris Coffey photo" class="author-photo">
					<h4>Chris Coffey</h4>
					<p>A programmer with a passion for functional programming and distriuted systems. I also love rock climbing & trying new food.</p>
				</li>
				<li><a href="/about/">Learn More</a></li>
				<li>
					<a href="mailto:Christopher.m.Coffey@gmail.com"><i class="fa fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="http://twitter.com/https://twitter.com/_chriscoffey"><i class="fa fa-twitter"></i> Twitter</a>
				</li>
				
				
				
				<li>
					<a href="http://github.com/https://github.com/ChrisCoffey"><i class="fa fa-github"></i> GitHub</a>
				</li>
				<li>
					<a href="http://stackoverflow.com/users/941243/chris"><i class="fa fa-stack-exchange"></i> Stackexchange</a>
				</li>
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="/posts/">All Posts</a></li>
				<li><a href="/tags/">All Tags</a></li>
			</ul>
		</li>
		
	    
	        
	    
	    <li><a href="/theme-setup/" >Theme Setup</a></li>
	  
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->


<div class="entry-header">
  <div class="image-credit">Image source: <a href="http://www.dargadgetz.com/ios-7-abstract-wallpaper-pack-for-iphone-5-and-ipod-touch-retina/">dargadgetz</a></div><!-- /.image-credit -->
  
    <div class="entry-image">
      <img src="/images/abstract-1.jpg" alt="Latest Posts">
    </div><!-- /.entry-image -->
  
  <div class="header-title">
    <div class="header-title-wrap">
      <h1>Fun With Code</h1>
      <h2>Latest Posts</h2>
    </div><!-- /.header-title-wrap -->
  </div><!-- /.header-title -->
</div><!-- /.entry-header -->

<div id="main" role="main">
  
<article class="hentry">
  <header>
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2015-02-01T14:39:45-05:00"><a href="/math/category-theory-for-most-of-us/">February 01, 2015</a></time></span><span class="author vcard"><span class="fn"><a href="/about/" title="About Chris Coffey">Chris Coffey</a></span></span>
      
      <span class="entry-reading-time pull-right">
        <i class="fa fa-clock-o"></i>
        
        Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="/math/category-theory-for-most-of-us/" rel="bookmark" title="Category Theory for Most of Us" itemprop="url">Category Theory for Most of Us</a></h1>
    
  </header>
  <div class="entry-content">
    

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2015-01-11T22:09:20-05:00"><a href="/musings/thoughts-on-micro-services/">January 11, 2015</a></time></span><span class="author vcard"><span class="fn"><a href="/about/" title="About Chris Coffey">Chris Coffey</a></span></span>
      
      <span class="entry-reading-time pull-right">
        <i class="fa fa-clock-o"></i>
        
        Reading time ~3 minutes
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="/musings/thoughts-on-micro-services/" rel="bookmark" title="Thoughts on Micro-Services" itemprop="url">Thoughts on Micro-Services</a></h1>
    
  </header>
  <div class="entry-content">
    <h1 id="microservices-unix-style-toolchains-for-the-internet-age">Microservices: Unix-style toolchains for the Internet age</h1>

<p>A very good question if you ask me. Like monads, it seems that most everyone has a slightly different understanding of what a microservice actually is. So, while I’m going to stay out of the monad-definition cottage industry for now, I think its important to explore the overloaded &amp; overly-buzzwordy world of microservices.</p>

<p>Wikipedia defines microservices as:</p>

<blockquote>
  <p>… microservices is a software architecture design pattern in which complex applications are composed of small, independent processes communicating with each other using language-agnostic APIs. 
These services are small, highly decoupled, and focus on doing a small task.</p>
</blockquote>

<p>Like any good buzzword definition, this one is littered with other confusing or ambiguous terms. What exactly is a “software architecture design pattern” in this context? We’ve all read the GoF design patterns book but I’m pretty sure we never saw anything about microservices or SingletonVisitorMicroserviceFactory in there, so is this the same type of pattern? In this context I’m taking the term design pattern to mean more of a design philosophy about decoupling software. That fits nicely with the language-agnostic APIs, which is also confusing but I’m pretty sure it just means REST, HTTP, Thrift, or some other custom communication protocol. The second sentence is significantly clearer and offers a recipe for creating a microservice: keep it small, decoupled &amp; focused. Perfect!</p>

<p>So is this a microservice?</p>

<div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">object</span> <span class="nc">MyFirstService</span> <span class="o">{</span>
	
	<span class="k">def</span> <span class="n">strToFoo</span><span class="o">(</span><span class="n">s</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Foo</span><span class="o">]</span> <span class="k">=</span> <span class="o">???</span>

<span class="o">}</span></code></pre></div>

<p>Its small, decoupled, communicates via raw strings (assuming its fronted by some REST interface) &amp; certainly focuses on doing just one small task. Unfortunately no, I don’t think this is a microservie, or if it is then it has a truly awful API. This is really just a single function exposed to the world, which means it’s either a <em>God</em> function that does everything or its too narrowly focused, and either way I think that means this isn’t a real micro service. </p>

<p>I think we need some more view points, so lets turn to Martin Fowler &amp; the good folks at Thoughtworks for <a href="http://martinfowler.com/articles/microservices.html">their take on microservices</a>:</p>

<blockquote>
  <p>The term “Microservice Architecture” has sprung up over the last few years to describe a particular way of designing software applications as suites of independently deployable services. While there is no precise definition of this architectural style, there are certain common characteristics around organization around business capability, automated deployment, intelligence in the endpoints, and decentralized control of languages and data.</p>
</blockquote>

<p>This brief definition doesn’t to his full article justice, but at its core it shows that micro services help manage complexity in some areas while lifting a significant amount of complexity from a classic 3-tier monolith’s code into the operations/ Dev-Ops level. I think this is a spectacular step in the right direction, but I take umbrage with the idea that microservices are a relatively recent phenomenon. </p>

<table>
  <tbody>
    <tr>
      <td>I don’t pretend to be a software historian, but I do happen to know that Unix &amp; Linux are built on top of a very old &amp; very specialized set of tools. The -nix tool-chain adheres to the “do one thing well” philosophy &amp; often exposes their results as a standardized output buffer. These outputs coupled with the venerable</td>
      <td>operator allow a collection of specialized tools to be composed together in a clear and logical manner in order to accomplish a larger goal. These specific tools have all been around for ~30 years, and the philosophy goes back even further.</td>
    </tr>
  </tbody>
</table>

<p>And that hits on my own definition of microservices, which is roughly equivalent to Martins but hopefully much clearer: </p>

<blockquote>
  <p>Microservices are internet-connected tools adhering to the Unix “do one thing well” philosophy &amp; sharing a common input/output language</p>
</blockquote>


  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2015-01-04T17:15:01-05:00"><a href="/math/primitive-power/">January 04, 2015</a></time></span><span class="author vcard"><span class="fn"><a href="/about/" title="About Chris Coffey">Chris Coffey</a></span></span>
      
      <span class="entry-reading-time pull-right">
        <i class="fa fa-clock-o"></i>
        
        Reading time ~3 minutes
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="/math/primitive-power/" rel="bookmark" title="Primitive Power" itemprop="url">Primitive Power</a></h1>
    
  </header>
  <div class="entry-content">
    <p>Flying back from a nice 2 week vacation in Texas &amp; I had a chance to think about primative operators. Specifically in this post I’ll be exploring what a primative opeartor actually is and whether there’s such a thing as “more powerful” primatives.</p>

<p>To get started I’ll be working with <strong>map</strong>a function we all hold near and dear. <strong>Map</strong>’s signature takes a value of some type <strong>A</strong> and a function <strong>A =&gt; B</strong>. So the full signature would be:</p>

<div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">](</span><span class="n">x</span><span class="k">:</span> <span class="kt">A</span><span class="o">)(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)</span> <span class="k">:</span> <span class="kt">B</span></code></pre></div>

<p>This function has as it’s range and domain all possible morphisms across two types. For instance, based on signature alone <strong>map</strong> can transform an <strong>Int</strong> into a <strong>Dinosaur</strong> via some magical function <strong>f(i: Int)</strong>. However, what it cannot do is transform an <strong>Int</strong> and a <strong>String</strong> into a <strong>Dinosaur</strong>. You could accomplish this via a <strong>Tuple[Int, String]</strong> and an <strong>f(t: (Int, String))</strong> but because you are still acting on a single parameter you’re unable to partially apply <strong>map</strong> to the tuple. Really this means we’ve been forced into evaluating all or none of the parameters with no ability to choose between them. That seems like an unnecessary constraint for a morphism.</p>

<p>This suggests there exists some more “powerful” version of <strong>map</strong> that allows us to partially apply across multiple parameters and evaluate them independently. For lack of a better name lets call this <strong>map2</strong>. <strong>Map2</strong> accepts two types of parameters &amp; returns a third, so we know it’s signature looks like this:</p>

<div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">def</span> <span class="n">map2</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span>,<span class="kt">C</span><span class="o">](</span><span class="n">a</span><span class="k">:</span> <span class="kt">A</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">B</span><span class="o">)(</span><span class="n">f</span><span class="k">:</span> <span class="o">(</span><span class="kt">A</span><span class="o">,</span> <span class="kt">B</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">C</span><span class="o">)</span><span class="k">:</span> <span class="kt">C</span></code></pre></div>

<p><strong>Map2</strong> is able to handle anything <strong>map</strong> can do by providing a no-op type as <strong>B</strong>’s type argument. For example, here’s <strong>map</strong> implemented via <strong>map2</strong>:</p>

<div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">](</span><span class="n">a</span><span class="k">:</span> <span class="kt">A</span><span class="o">)(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">B</span> <span class="o">=</span> 
	<span class="n">map2</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="nc">NoOp</span><span class="o">)((</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="o">))</span></code></pre></div>

<p>This on it’s own buys us alot of power because we no longer need to worry about actually applying the computation for the morphism in <strong>map</strong>, instead we can defer it into <strong>map2</strong>. The next question I have about <strong>Map2</strong> is whether we can create a function <strong>Map3</strong> that is again more powerful than <strong>Map2</strong>? Logically it would seem that since <strong>Map2</strong>’s domain and range are strictly supersets of the domain and range for <strong>Map</strong> that it holds <strong>Map2</strong> should be a subset of <strong>Map3</strong>, right?</p>

<p>It turns out this isn’t quite the case on the implemetation level. You can actually implement all other arity mapping functions in terms of <strong>Map2</strong> by using a trick simmilar to have a right fold operates. That is to say via building up a chain of function calls to provide the proper arity. Here’s <strong>Map3</strong>:</p>

<div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">def</span> <span class="n">map3</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span>, <span class="kt">C</span>, <span class="kt">D</span><span class="o">](</span><span class="n">a</span><span class="k">:</span> <span class="kt">A</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">B</span><span class="o">,</span> <span class="n">c</span><span class="k">:</span> <span class="kt">C</span><span class="o">)(</span><span class="n">f</span><span class="k">:</span> <span class="o">(</span><span class="kt">A</span><span class="o">,</span> <span class="kt">B</span><span class="o">,</span> <span class="n">C</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">D</span><span class="o">)</span><span class="k">:</span> <span class="kt">D</span> <span class="o">=</span> 
	<span class="n">map2</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)((</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">map2</span><span class="o">(</span><span class="n">c</span><span class="o">,</span> <span class="nc">NoOp</span><span class="o">)(</span><span class="n">f</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">c</span><span class="o">)))</span></code></pre></div>

<p>This ends up creating a chain of map2 calls that can be composed together as <strong>f • g • …</strong> to generate the full chain. </p>

<p>As I think about it, it is actually possible to use the same approach to construct a similarly deep function call chain for <strong>map</strong>, allowing us to use <strong>map</strong> as the base primative and implement all other arity <strong>map</strong>’s in terms of the base primitive.</p>

<p>With standard Map it’s still impossible to use a single function call to support &gt;1 parameter, where as <strong>map</strong> with arity &gt; 1 inherently supports this</p>

<p>I’ll update this post once I’ve had a chance to do some more research on which of the two functions is actually the base primitive..</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2014-12-23T00:00:00-05:00"><a href="/more-state-machines/">December 23, 2014</a></time></span><span class="author vcard"><span class="fn"><a href="/about/" title="About Chris Coffey">Chris Coffey</a></span></span>
      
      <span class="entry-reading-time pull-right">
        <i class="fa fa-clock-o"></i>
        
        Reading time ~7 minutes
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="/more-state-machines/" rel="bookmark" title="More State Machines" itemprop="url">More State Machines</a></h1>
    
  </header>
  <div class="entry-content">
    <p>In my last post about state machines I talked about how they can help provide simplifying assumptions for modeling your applications. However, all the simplifying assumptions aren’t very helpful if you can’t actually change your data. In this post I’ll discuss guarded transitions &amp; how to model them in Scala. </p>

<h5 id="the-basics">The Basics</h5>
<p>A basic state machine, especially the DFA we modeled in the previous post, transitions directly from the current state to the new state upon an input. However, how do we model this if we need to perform a calculation/ operation that may fail during the transition from state <strong>A</strong> -&gt; <strong>B</strong>? The way I see it, you have to options:</p>

<ul>
  <li>Hide the side effect in the transition and make the transition synchronous.</li>
  <li>Introduce an intermediate state <strong>B’</strong> representing the intent or attempt to transition from <strong>A</strong> -&gt; <strong>B</strong>. </li>
</ul>

<p>In the first option, there’s a big advantage in keeping your conceptual model clean. This makes it easier for others to consume. Unfortunately, as soon as you introduce guarded transitions this conceptual “clarity” actually turns into a muddy pool of non-determinism. This is because as soon as the possibility of failure is introduced you have the possibility that a transition from <strong>A</strong> -&gt; <strong>B</strong> is no longer a DFA, but an NDFA (Non-Deterministic Finite Automata) because if the transition fails, then you’ll actually wind up back in <strong>A</strong> (or a failure state), otherwise the machine transitions to <strong>B</strong>. As you can imagine, this is more difficult to reason about. In a Scala implementation this also means you don’t know that the transition was requested in the event of a complete failure.</p>

<p>The alternative approach using an intermediate state means your diagram becomes much more complicated, with each intermediate state that may fail protected by a guard state. However daunting this pattern may seem initially, it’s actually incredibly easy to reason about so long as developers all understand the pattern (just like any other design pattern). The major advantages here are that the FSM is always a DFA, i.e. you always know exactly the state you’re in. If there is input that triggers a guarded transition it immediately transitions into the guard state, then returns. Yup, this means that you’re always transitioning immediately then handling the forward/backward transition in a callback. The only allowed transitions from <strong>B’</strong> should be to <strong>A</strong> on failure or <strong>B</strong> on success. </p>

<h5 id="a-simple-scala-example">A Simple Scala Example</h5>
<p>Bank accounts. Most of us have them (some prefer a shoe-box under the mattress though), and all of us have probably either used one as an example or read examples using them before so the mechanics should be pretty straight forward. </p>

<p>To start with, lets think about what we’ll need to model a DFA. To start with, we need the transition table and a domain to work with: </p>

<div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">trait</span> <span class="nc">DFAState</span>

<span class="k">trait</span> <span class="nc">Result</span>
<span class="k">trait</span> <span class="nc">Request</span>

<span class="k">trait</span> <span class="nc">DFA</span><span class="o">[</span><span class="kt">T</span>, <span class="kt">Input</span><span class="o">]</span> <span class="o">{</span>
	
	<span class="k">def</span> <span class="n">transition</span><span class="o">(</span><span class="n">in</span><span class="k">:</span> <span class="kt">Input</span><span class="o">)(</span><span class="n">state</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span><span class="k">:</span> <span class="o">(</span><span class="kt">Result</span><span class="o">,</span> <span class="kt">T</span><span class="o">)</span>

<span class="o">}</span>

<span class="k">trait</span> <span class="nc">TranRequest</span><span class="o">{</span>
  <span class="k">val</span> <span class="n">amount</span><span class="k">:</span> <span class="kt">Int</span>
<span class="o">}</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Credited</span><span class="o">(</span><span class="n">amount</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Result</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Debited</span><span class="o">(</span><span class="n">amount</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Result</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">OverdrawApproved</span><span class="o">(</span><span class="n">amount</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Result</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">OverdrawRejected</span><span class="o">(</span><span class="n">amount</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Result</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">ApproveOverdraw</span><span class="o">(</span><span class="n">amount</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Request</span> <span class="k">with</span> <span class="nc">TranRequest</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">RejectOverdraw</span><span class="o">(</span><span class="n">amount</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Result</span> <span class="k">with</span> <span class="nc">TranRequest</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Credit</span><span class="o">(</span><span class="n">amount</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Request</span> <span class="k">with</span> <span class="nc">TranRequest</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Debit</span><span class="o">(</span><span class="n">amount</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Result</span> <span class="k">with</span> <span class="nc">TranRequest</span>

<span class="k">trait</span> <span class="nc">AccountState</span> <span class="k">extends</span> <span class="nc">DFAState</span>
<span class="k">case</span> <span class="k">object</span> <span class="nc">Open</span> <span class="k">extends</span> <span class="nc">AccountState</span>
<span class="k">case</span> <span class="k">object</span> <span class="nc">Overdrawn</span> <span class="k">extends</span> <span class="nc">AccountState</span></code></pre></div>

<p>There’s pretty much nothing actually going on here, but I’ve defined the basic structures we’ll need for working with our bank account. We can attempt to either Credit or Debit the account, which will result in a credit or debit to the account. If we try to take too much money out of the account it triggers an overdraw, which needs to ask a hypothetical overdraw controller if we’re allowed to do this. Given that we don’t want to immediately allow the overdraw, hand out the money, then come back and decide “oops, probably shouldn’t have done that”, we’ll need some intermediate state between Open &amp; Overdrawn.</p>

<p>To that end I’ve created a simple wrapper state, <em>Guarded[T]</em> which wraps any other state and the initial state we were in. Pretty easy to rollback when you’re carrying the initial state around w/ you, isn’t it! Okay, lets look at some code:</p>

<div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">case</span> <span class="k">class</span> <span class="nc">Guarded</span><span class="o">[</span><span class="kt">A</span> <span class="k">&lt;:</span> <span class="kt">AccountState</span>, <span class="kt">B</span> <span class="k">&lt;:</span> <span class="kt">AccountState</span><span class="o">](</span><span class="n">s</span><span class="k">:</span> <span class="kt">A</span><span class="o">,</span> <span class="n">prev</span><span class="k">:</span> <span class="kt">B</span><span class="o">)</span>

<span class="cm">/**</span>
<span class="cm"> * A simple case class representing a bank account.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">BankAccount</span><span class="o">(</span><span class="n">balance</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">state</span><span class="k">:</span> <span class="kt">AccountState</span><span class="o">)</span>

<span class="k">object</span> <span class="nc">BankAccount</span> <span class="k">extends</span> <span class="nc">DFA</span><span class="o">[</span><span class="kt">BankAccoun</span>, <span class="kt">TransactionRequest</span><span class="o">]{</span>

	<span class="k">def</span> <span class="n">transition</span><span class="o">(</span><span class="n">in</span><span class="k">:</span> <span class="kt">Input</span><span class="o">)(</span><span class="n">state</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span><span class="k">:</span> <span class="o">(</span><span class="kt">Result</span><span class="o">,</span> <span class="kt">T</span><span class="o">)={</span>
 		<span class="n">state</span><span class="o">.</span><span class="n">state</span> <span class="k">match</span><span class="o">{</span>
      <span class="k">case</span> <span class="nc">Open</span> <span class="k">=&gt;</span> <span class="o">{</span>
      <span class="n">in</span> <span class="k">match</span> <span class="o">{</span>
        <span class="k">case</span> <span class="nc">Credit</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="nc">Credited</span><span class="o">(</span><span class="n">x</span><span class="o">),</span> <span class="nc">BankAccount</span><span class="o">(</span><span class="n">balancePostTransaction</span><span class="o">(</span><span class="n">state</span><span class="o">,</span> <span class="n">in</span><span class="o">),</span> <span class="nc">Open</span><span class="o">))</span>
        <span class="k">case</span> <span class="nc">Debit</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="k">if</span> <span class="n">balancePostTransaction</span><span class="o">(</span><span class="n">state</span><span class="o">,</span> <span class="n">in</span><span class="o">)</span> <span class="o">&gt;=</span><span class="mi">0</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="nc">Debited</span><span class="o">(</span><span class="n">x</span><span class="o">),</span> <span class="nc">BankAccount</span><span class="o">(</span><span class="n">balancePostTransaction</span><span class="o">(</span><span class="n">state</span><span class="o">,</span> <span class="n">in</span><span class="o">),</span> <span class="nc">Open</span><span class="o">))</span>
        <span class="k">case</span> <span class="nc">Debit</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="nc">Debited</span><span class="o">(</span><span class="n">x</span><span class="o">),</span> <span class="nc">BankAccount</span><span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="n">balance</span> <span class="o">,</span> <span class="nc">Guarded</span><span class="o">(</span><span class="nc">Overdrawn</span><span class="o">,</span> <span class="nc">Open</span><span class="o">)))</span>
       <span class="o">}</span>
      <span class="o">}</span>
        <span class="k">case</span> <span class="nc">Guarded</span><span class="o">(</span><span class="nc">Overdrawn</span><span class="o">,</span> <span class="n">prev</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">in</span> <span class="k">match</span> <span class="o">{</span>
          <span class="c1">// Allow the guarded transition to proceed</span>
          <span class="k">case</span> <span class="nc">ApproveOverdraw</span><span class="o">(</span><span class="n">amt</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="nc">OverdrawApproved</span><span class="o">(</span><span class="n">amt</span><span class="o">),</span> <span class="nc">BankAccount</span><span class="o">(</span><span class="n">balancePostTransaction</span><span class="o">(</span><span class="n">state</span><span class="o">,</span> <span class="n">in</span><span class="o">),</span> <span class="nc">Overdrawn</span><span class="o">)</span>
            <span class="c1">// Reject the guarded transition and move back to prior state</span>
            <span class="k">case</span> <span class="nc">RejectOverdraw</span><span class="o">(</span><span class="n">amt</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="nc">OverdrawRejected</span><span class="o">(</span><span class="n">amt</span><span class="o">),</span> <span class="n">state</span><span class="o">.</span><span class="n">copy</span><span class="o">(</span> <span class="n">state</span> <span class="k">=</span> <span class="n">prev</span><span class="o">))</span>
        <span class="o">}</span>
        <span class="k">case</span> <span class="nc">Overdrawn</span> <span class="k">=&gt;</span> <span class="o">{</span>
          <span class="k">case</span> <span class="nc">Credit</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">???</span>
        <span class="o">}</span> 
  <span class="o">}</span>
  <span class="o">}</span>

  <span class="k">private</span> <span class="k">def</span> <span class="n">balancePostTransaction</span><span class="o">(</span><span class="n">acct</span><span class="k">:</span> <span class="kt">BankAccount</span><span class="o">,</span> <span class="n">tran</span><span class="k">:</span> <span class="kt">TranRequest</span><span class="o">)</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="o">{</span>
    <span class="n">acct</span><span class="o">.</span><span class="n">balance</span> <span class="o">+</span> <span class="n">tran</span><span class="o">.</span><span class="n">amount</span> 
  <span class="o">}</span>


<span class="o">}</span></code></pre></div>

<p>I tend to have a bad habit of throwing a lot of code up before speaking to it, and this is no exception. To start with, we have the <em>Guarded[A,B]</em> type described above, followed by a trivial context (state carrier) and the transition table. Most of the transitions are unrelated to what we’re actually concerned with here, but they help to add some ambiance (or I got distracted and wrote them during this flight…). </p>

<p>The really interesting piece and the entire reason for this post is the use of Guarded. You’ll notice halfway through the transition table that attempts to overdraw don’t result in any change to the account balance and they move the state to Guarded. This pattern allows a quick and easy rollback in the event of a failed overdraw, or a successful transition to Overdrawn with the new amount computed. </p>

<p>What does this buy us? I’ll explain.</p>

<h5 id="why-use-the-guarded-transition-pattern">Why use the <em>Guarded Transition</em> Pattern?</h5>
<p>When compared to the alternative of wrapping a possibly failing computation up into a transition, the Guarded pattern has two main advantages. First, it forces a complete separation of concerns between the logic and the DFA model. For instance, a possible implementation of this may involve a parent service that orchestrates actions based on the DFA’s response following a transition. This allows the service to wrap the transition up in a Future, execute it synchronously, or do anything else with it, all unbeknown to the DFA. Additionally if events are being persisted real-time w/ something like <a href="link required">Akka Persistence</a> you’ll know exactly what computation was in-progress if the system crashes. Secondly, the guarded transition pattern provides a simple structured error handling &amp; rollback approach for potentially failing transitions. This is especially important if that transition involves a 3rd party service for something like authentication, lookup, etc…</p>


  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2014-12-17T19:50:10-05:00"><a href="/math/lambda-calculus-whats-it-good-for/">December 17, 2014</a></time></span><span class="author vcard"><span class="fn"><a href="/about/" title="About Chris Coffey">Chris Coffey</a></span></span>
      
      <span class="entry-reading-time pull-right">
        <i class="fa fa-clock-o"></i>
        
        Reading time ~3 minutes
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="/math/lambda-calculus-whats-it-good-for/" rel="bookmark" title="Lambda Calculus: What's It Good For?" itemprop="url">Lambda Calculus: What's It Good For?</a></h1>
    
  </header>
  <div class="entry-content">
    <p>“What’s the point of λ Calculus?”
	- Matt</p>

<p>I started this blog off with <a href="http://chriscoffey.github.io/math/beta-eta-and-lambda/">Lambda Calculus for Government Majors</a> which covered the basic concepts &amp; definitions of lambda calculus. But honestly, knowing what λ means doesn’t really get you anywhere. My colleague Matt pointed this out after reading the piece, and he’s right. So what can you do with λ calculus? I mean really, what’s the point of this fancy algebra? Hopefully the following article explains why people get so excited about this stuff.</p>

<h3 id="refresher">Refresher</h3>

<p>λa.a  =&gt;  λ indicates this is a lambda expression/function
β reduction =&gt; replace a given λ expression with a common name
α conversion =&gt; create unique names for each variable to prevent collisions
η reduction =&gt; strip out unnecessary bound variables</p>

<p>For more info on these just take a peek back at my earlier post.</p>

<h3 id="addition">Addition</h3>

<p>Before getting into what you can do with λ calculus, I should probably show an example of how it actually works once it’s been expanded. Expanding a λ expression is essentially replacing bound variables with provided arguments. This can end up throwing a ton of λ and parens at you, but it helps clarify the relationship between a reduced function &amp; any data passed in. To start with, I’ll take advantage of the fact that λ calculus is simple. So simple that it has no concept of numbers, addition, or anything else. This poses a bit of a problem if I’m trying to illustrate using λ for addition. I guess we’ll just start at the beginning and define the natural numbers.</p>

<p>We know that for all natural numbers  <em>x</em> &gt;= 0 that <em>x</em> + 1 is also a natural number. This means the notation we’re all use to actually use for, say 5, is equivalent to 0+1+1+1+1+1. I’ll use Church encoding (named after Alonzo Church, the inventor of λ calculus) to encode this property into valid λ functions.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">zero</span> <span class="o">=</span> λa.λn.n
	<span class="nv">one</span> <span class="o">=</span> λa.λn.a n
	<span class="nv">two</span> <span class="o">=</span> λa.λn.a <span class="o">(</span>a n<span class="o">)</span>
	<span class="nv">three</span> <span class="o">=</span> λa.λn.a <span class="o">(</span>a <span class="o">(</span>a  n<span class="o">))</span>
	....</code></pre></div>

<p>What’s really interesting about these numbers and pretty much every other λ expression you’ll see is that it’s a higher order function, or a function that takes another function. Those lambda expressions will grow pretty large pretty quickly, so I’ll just be using normal numbers instead (developers are lazy after all). </p>

<p>Are we ready for addition yet? We know how to create numbers, so what else do we need? It turns out not much:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">add</span> <span class="o">=</span> λx.λy.λa.λn.m a <span class="o">(</span>y a x<span class="o">)</span></code></pre></div>

<p>So now that I have a whole bunch of λ’s &amp; some parens, what’s actually going on here? Let’s use 1 + 1 as an example:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">add<span class="o">(</span> one one<span class="o">)</span> <span class="o">=</span> <span class="o">((</span>λx.λy.λa.λn.x a <span class="o">(</span>y a n<span class="o">)</span> <span class="o">)</span> λc.λd.c d <span class="o">)</span> λ.e.λf.e <span class="nv">f</span>
	<span class="o">=</span>&gt; I performed an α conversion on the line above to avoid shadowing on <span class="s1">&#39;one&#39;</span>
	<span class="o">((</span>λc.λd.c d<span class="o">)</span> a <span class="o">(</span>y a n<span class="o">))</span> λe.λf.e f
	<span class="o">((</span>λc.λd.c d<span class="o">)</span> a <span class="o">((</span>λ.e.λf.e f<span class="o">)</span> a n<span class="o">))</span>
	c <span class="o">((</span>λe.λf.e f<span class="o">)</span> a n<span class="o">)</span>
	a <span class="o">(</span>a n<span class="o">)</span></code></pre></div>

<p>Who knew something as simple as 1 + 1 would expand into that! Thankfully this is the equivalent of doing binary arithmetic in assembler, i.e. something you won’t need to do again. On the positive side this illustrates the power of function expansion using higher order functions. It takes a while to work through, and I’d strongly recommend working through the same example using 1 + 2 since you already know the answer is λa.λn.a (a (a n)).</p>

<h3 id="what-use-is-this">What Use Is This?</h3>
<p>One word. Compilers. When you step back and think about it, λ Calculus is actually Turing Complete (hopefully that’s more apparent after our foray into Church encoding), so it’s a good fit for trying things out quickly. Anything that can compile down to λ Calculus (any Turing complete language) can then be translated up into another language for execution. So whenever someone says “every language is the same” you can show off your knowledge of λ calculus &amp; isomorphisms between languages!</p>

<p>Hopefully this helped, but if you want to learn more check out these resources:</p>

<p><a href="http://en.wikipedia.org/wiki/Lambda_calculus">Wikipedia</a></p>

<p><a href="http://matt.might.net/articles/compiling-up-to-lambda-calculus/">Compiling Up to Lambda Calculus</a></p>


  </div><!-- /.entry-content -->
</article><!-- /.hentry -->


<div class="pagination">
  
    Previous
  
  <ul class="inline-list">
    <li>
      
        <span class="current-page">1</span>
      
    </li>
    
      <li>
        
          <a href="/page2">2</a>
        
      </li>
    
  </ul>
  
    <a href="/page2" class="btn">Next</a>
  
</div><!-- /.pagination -->
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2015 Chris Coffey. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/hpstr/" rel="notfollow">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>



          

</body>
</html>